<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="logos/plicon.png" type="images/x-icon" width="40" height="40">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Calistoga&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <title>Deposit</title>
    <script type="module" src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule="" src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.js"></script>
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <style>
     * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
       }
   
    </style>
</head>
<body style="background-color: white;">
    <header style="height: 10vh; width: 100%; display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; justify-content: center;">
          <div><a href="/main"><ion-icon name="arrow-round-back" style="font-weight: bold; color: purple; font-size: 2rem;"></ion-icon></a></div>
            <h1 style="margin:0 10px 10px 10px; font-weight: bold; font-family: cursive; font-size: 1.75rem; color: purple;">Deposit</h1>
        </div>
        <span style="margin-right: 20px;"><img src="logos/plicon.png" alt="Paypal" width="40" height="40"></span>
        
    </header>

    <main style="height: 80vh; width: 100vw; background-color: transparent; transition: all 1.5s ease-in-out;">

       <div class="choose" style="height: 10vh; width: 100vw; display: flex; align-items: center; justify-content: center; background-color: #fff;">
        
            <h1 style="color: blue; font-family: cursive; font-style: italic; font-weight: bold; font-size: 1.8rem; text-align: center; text-wrap: wrap;">Choose Amount </h1>
         
       </div> 

       <section class="choose-amount" style="width: 100vw; padding: 10px; background-color: transparent; display: flex; flex-wrap: wrap; align-items: center; justify-content: center;">
        
           <button onclick="purchase(100)" class="amounts" style="height: 130px; width: 160px; display: flex; justify-content: center; align-items: center; flex-flow: column nowrap; border: .5px solid purple; outline: none; margin: 8px; box-shadow: 0 4px 8px 0 rgba(65, 5, 65, 0.656), 0 5px 10px 0 rgba(65, 5, 65, 0.456); background-image: linear-gradient(45deg, grey, silver, whitesmoke, white, whitesmoke, silver,grey) ; border-radius: 30px;">
              <div class="amount-span" style="display: flex; align-items: center; justify-content: center;">
              <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px; margin-right: 5px;">KSH</h1>
              <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px;">100</h1>
              </div>
              <img src="/logos/coin.png" alt="$" height="35" width="35"> 
           </button>
           <button onclick="purchase(200)" class="amounts" style="height: 130px; width: 160px; display: flex; justify-content: center; align-items: center; flex-flow: column nowrap; border: .5px solid purple; outline: none; margin: 8px; box-shadow: 0 4px 8px 0 rgba(65, 5, 65, 0.656), 0 5px 10px 0 rgba(65, 5, 65, 0.456); background-image: linear-gradient(45deg, grey, silver, whitesmoke, white, whitesmoke, silver,grey) ; border-radius: 30px;">
              <div class="amount-span" style="display: flex; align-items: center; justify-content: center;">
                <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px; margin-right: 5px;">KSH</h1>
                <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px;">200</h1>
              </div>
              <img src="/logos/coin.png" alt="$" height="35" width="35"> 
           </button>
           <button onclick="purchase(500)" class="amounts" style="height: 130px; width: 160px; display: flex; justify-content: center; align-items: center; flex-flow: column nowrap; border: .5px solid purple; outline: none; margin: 8px; box-shadow: 0 4px 8px 0 rgba(65, 5, 65, 0.656), 0 5px 10px 0 rgba(65, 5, 65, 0.456); background-image: linear-gradient(45deg, grey, silver, whitesmoke, white, whitesmoke, silver,grey) ; border-radius: 30px;">
              <div class="amount-span" style="display: flex; align-items: center; justify-content: center;">
                <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px; margin-right: 5px;">KSH</h1>
                <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px;">500</h1>
              </div>
              <img src="/logos/coin.png" alt="$" height="35" width="35"> 
           </button>
           <button onclick="purchase(1000)" class="amounts" style="height: 130px; width: 160px; display: flex; justify-content: center; align-items: center; flex-flow: column nowrap; border: .5px solid purple; outline: none; margin: 8px; box-shadow: 0 4px 8px 0 rgba(65, 5, 65, 0.656), 0 5px 10px 0 rgba(65, 5, 65, 0.456); background-image: linear-gradient(45deg, grey, silver, whitesmoke, white, whitesmoke, silver,grey) ; border-radius: 30px;">
              <div class="amount-span" style="display: flex; align-items: center; justify-content: center;">
                <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px; margin-right: 5px;">KSH</h1>
                <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px;">1000</h1>
              </div>
              <img src="/logos/coin.png" alt="$" height="35" width="35"> 
           </button>
           <button onclick="purchase(2000)" class="amounts" style="height: 130px; width: 160px; display: flex; justify-content: center; align-items: center; flex-flow: column nowrap; border: .5px solid purple; outline: none; margin: 8px; box-shadow: 0 4px 8px 0 rgba(65, 5, 65, 0.656), 0 5px 10px 0 rgba(65, 5, 65, 0.456); background-image: linear-gradient(45deg, grey, silver, whitesmoke, white, whitesmoke, silver,grey) ; border-radius: 30px;">
               <div class="amount-span" style="display: flex; align-items: center; justify-content: center;">
                 <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px; margin-right: 5px;">KSH</h1>
                 <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px;">2000</h1>
               </div>
               <img src="/logos/coin.png" alt="$" height="35" width="35"> 
           </button>
           <button onclick="purchase(5000)" class="amounts" style="height: 130px; width: 160px; display: flex; justify-content: center; align-items: center; flex-flow: column nowrap; border: .5px solid purple; outline: none; margin: 8px; box-shadow: 0 4px 8px 0 rgba(65, 5, 65, 0.656), 0 5px 10px 0 rgba(65, 5, 65, 0.456); background-image: linear-gradient(45deg, grey, silver, whitesmoke, white, whitesmoke, silver,grey) ; border-radius: 30px;">
               <div class="amount-span" style="display: flex; align-items: center; justify-content: center;">
                 <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px; margin-right: 5px;">KSH</h1>
                 <h1 style="font-size: 1.35rem; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; font-style: italic; font-weight: bold; color: purple; margin-bottom: 5px;">5000</h1>
               </div>
               <img src="/logos/coin.png" alt="$" height="35" width="35"> 
           </button>
      
         
    </section>

    </main>

    <div class="paypal-section" style="display: none; position: absolute; width: 95vw; margin-top: 5px; border-radius: 20px; min-height: fit-content; top: 10%; left: 50%; transform: translateX(-50%); z-index: 5; background-color: aliceblue; transition: all 1s ease-in-out;">
        <div class="close" style="width: 100%; height: 10%; display: flex; justify-content: space-between;">
           <img src="/logos/paypal.png" alt="" width="120" height="40">
           <button id="close" style="height: 70%; width: 50px; display: flex; justify-content: center; align-items: center; outline: none; border: none; background-color: blue; border-radius: 0 20px 0 20px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" style="fill: white;transform: msFilter"><path d="m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"></path></svg>
           </button>
        </div>
        <div id="paypal-button-container" style="height: 20%; width: 70%; margin: 10px auto 10px;"></div>
        <input type="number" id="amount" name="amount" style="display: none;">

    </div>

    <footer style="position: fixed; bottom: 0; height: 10vh; width: 100vw; margin-block: .75rem; display: flex; align-items: center; justify-content: center;">
        <div style="display: flex; align-items: center; justify-content: center; font-weight: bold; ">
            <h1 style="font-weight: 900; font-size: 1.2rem; color: purple; font-family: cursive;">Xtream</h1>
            <span><img src="logos/plicon.png" alt="" width="40" height="40"></span>
            <h1 style="font-weight: 900; font-size: 1.2rem; color: purple; font-family: cursive;">League</h1>
        </div>

    </footer>

   

    <script src="paypal.js"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=<%= CLIENT %>&components=buttons"></script>

    <script>
       
        const inputElem = document.getElementById('amount')

        paypal.Buttons({
            style: {
                layout: 'vertical',
                color: 'gold',
                shape: 'pill',
                label: 'paypal'
            },
            createOrder: function (data, actions) {
              return actions.order.create({
                   purchase_units: [
                    {
                       amount: { 
                         value: inputElem.value
                       }
                    }
               ]
            })
       },
       onApprove: function (data, actions) {
           return actions.order.capture().then((details) => {
                  const paidValue = details.purchase_units[0].amount.value
                  const email = details.payer.email_address 
               
                  fetch('/confirm-deposit', {
                    method: 'POST',
                    headers: {
                      "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                      valuePaid: paidValue,
                      paypalEmail: email,
                    })

                  })
                  .then((res) => {
                    if (res.ok) { 
                    
                      return res.json()
                     }
                    else { return res.json().then(json => Promise.reject(json)) }
                  })
                  .then((data) => {
                    console.log(data)
                    const tranxId =  data._id
                    const paypal = data.pplEmail 

                    window.location.href = `/confirm-deposit?ajaxvv2ppl=${tranxId}&email=${paypal}`
                  })

                  .catch((e) => { 
                    console.error(e.error)
                    alert('Server Error!!.Please contact Customer support') 
                    window.location.href = '/main'
                  })
       })
      },
       onCancel: function () {
           alert('You Canceled the Request')
           window.location.href = '/deposit'
       },
       onError: function () {
           alert('Server Error!! Please try Again')
           window.location.href = '/deposit'
       }
        }).render('#paypal-button-container')
       
      
    </script>
</body>
</html>